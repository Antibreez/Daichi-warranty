!function(){var e=document.querySelector("input[name='name']"),t=document.querySelector("input[name='password']"),n=document.querySelector(".authorization__button");if(e&&t&&n){var s=function(e){var t=e.target;t.classList.contains("js--wrong-input")&&t.classList.remove("js--wrong-input")};n.addEventListener("click",(function(){""===e.value&&e.classList.add("js--wrong-input"),""===t.value&&t.classList.add("js--wrong-input")})),e.addEventListener("input",s),t.addEventListener("input",s)}}(),function(){var e=document.querySelector(".not-used-products__button"),t=document.querySelector(".not-used-products__show"),n=document.querySelector(".not-used-products__hide"),s=document.querySelector(".not-used-products__content");if(e){var a=function(e){e.classList.toggle("shown"),e.classList.toggle("hidden")};e.addEventListener("click",(function(){a(t),a(n),s.classList.toggle("show")}))}}(),function(){var e=document.querySelector(".device-registration"),t=document.querySelectorAll(".device-registration__navigation-item"),n=(document.querySelector(".contacts"),document.querySelector(".contacts__phone-number")),s=document.querySelector(".contacts__code"),a=document.querySelector("input[name='phone-number']"),r=document.querySelector("input[name='phone-code']"),o=document.querySelector(".contacts__phone-form button"),c=document.querySelector(".contacts__code-form button"),i=document.querySelector(".contacts__phone-form"),d=document.querySelector(".contacts__code-form"),u=document.querySelector(".contacts__product-card .product-card__change"),l=document.querySelector(".contacts__selected-phone"),m=document.querySelector(".contacts__code-error-message"),v=document.querySelector(".contacts__code-form label"),p="Указан неверный код, осталось попыток: 1",L="Вы превысили количество попыток, следующий запрос кода возможен через 10 минут",y=0;if(a){new Inputmask("+7(999)999-99-99").mask(a),new Inputmask("9999999",{placeholder:""}).mask(r);var _=function(e){e.classList.contains("hidden")&&e.classList.remove("hidden")},f=function(e){e.classList.contains("hidden")||e.classList.add("hidden")};a.addEventListener("input",(function(){var e=a.value;16===e.length&&-1===e.indexOf("_")?o.removeAttribute("disabled"):o.setAttribute("disabled","")})),u.addEventListener("click",(function(){e.classList.remove("js--contacts"),e.classList.add("js--device-data"),t[0].classList.remove("js--checked"),t[1].classList.remove("js--active"),_(n),f(s)})),i.addEventListener("submit",(function(e){e.preventDefault(),l.textContent=a.value,f(n),_(s)})),r.addEventListener("input",(function(){m.textContent="",v.classList.contains("js--error")&&v.classList.remove("js--error"),r.classList.contains("js--wrong-input")&&r.classList.remove("js--wrong-input"),7===r.value.length?c.removeAttribute("disabled"):c.setAttribute("disabled","")})),d.addEventListener("submit",(function(t){t.preventDefault(),"0000000"!==r.value?(v.classList.contains("js--error")||v.classList.add("js--error"),r.classList.contains("js--wrong-input")||r.classList.add("js--wrong-input"),0===y&&(m.textContent=p),y>0&&(m.textContent=L,c.setAttribute("disabled","")),y++):(e.classList.add("js--personal-data"),e.classList.remove("js--contacts"))}))}}(),function(){var e=document.querySelector("body"),t=document.querySelector(".device-registration"),n=document.querySelectorAll(".device-registration__navigation-item"),s=(document.querySelector(".device-data"),document.querySelector(".device-data form")),a=document.querySelector("label[for='serial-number-1'] button"),r=document.querySelector(".popup-warranty"),o=document.querySelector(".popup-warranty__close"),c=document.querySelector(".popup-warranty__overlay"),i=document.querySelector(".device-data__purchase-date"),d=document.querySelector(".device-data__calendar"),u=document.querySelectorAll(".device-data__serial-number"),l=document.querySelector(".device-data__submit");if(a){var m=function(){6===u[0].value.length&&6===u[1].value.length&&6===u[2].value.length&&/^[0-9.]+$/.test(i.value)?l.removeAttribute("disabled"):l.setAttribute("disabled","")},v=function(e){return Math.floor(e/10)>0?e:"0"+e},p=new Pikaday({field:d,firstDay:1,onSelect:function(){var e=new Date(p);i.value=function(e){var t=(e=new Date(e)).getDate(),n=e.getMonth()+1,s=e.getFullYear();return v(t)+"."+v(n)+"."+s}(e),m()}});new Inputmask("99.99.9999",{placeholder:"ДД.ММ.ГГГГ"}).mask(i);var L=function(e){var t=e.target;6===t.value.length?(t.classList.contains("js--wrong-input")&&t.classList.remove("js--wrong-input"),"serial-number-1"!==t.id&&"serial-number-2"!==t.id||t.nextSibling.nextSibling.focus(),"serial-number-3"===t.id&&i.focus()):t.classList.add("js--wrong-input"),m()},y=function(){r.classList.add("hidden"),e.classList.remove("popup")};a.addEventListener("click",(function(){r.classList.remove("hidden"),e.classList.add("popup")})),o.addEventListener("click",(function(){y()})),c.addEventListener("click",(function(){y()})),u.forEach((function(e){e.addEventListener("input",L)})),i.addEventListener("input",(function(){m(),console.log(i.value.length)})),s.addEventListener("submit",(function(e){e.preventDefault(),t.classList.add("js--contacts"),t.classList.remove("js--device-data"),n[0].classList.add("js--checked"),n[1].classList.add("js--active")}))}}(),function(){var e=document.querySelector(".device-registration"),t=document.querySelectorAll(".device-registration__navigation-item"),n=document.querySelector(".personal-data__form"),s=document.querySelector(".personal-data input[name='surname']"),a=document.querySelector(".personal-data input[name='name']"),r=document.querySelector(".personal-data input[name='patronymic']"),o=document.querySelector(".personal-data input[name='city']"),c=document.querySelector(".personal-data input[name='email']"),i=document.querySelector(".personal-data input[type='checkbox']"),d=document.querySelector(".personal-data__agreement-wrapper label"),u=document.querySelector(".personal-data__text-wrapper"),l=document.querySelector(".personal-data__button");if(s){var m=function(){s.validity.valid&&a.validity.valid&&r.validity.valid&&o.validity.valid&&c.validity.valid&&i.checked?l.removeAttribute("disabled"):l.setAttribute("disabled","")},v=function(e){m();var t=e.target,n=t.parentNode.querySelector("p");t.validity.valid||(n.classList.contains("js--error")||n.classList.add("js--error"),t.classList.contains("js--wrong-input")||t.classList.add("js--wrong-input")),t.validity.valid&&(n.classList.contains("js--error")&&n.classList.remove("js--error"),t.classList.contains("js--wrong-input")&&t.classList.remove("js--wrong-input"))};s.addEventListener("input",v),a.addEventListener("input",v),r.addEventListener("input",v),o.addEventListener("input",v),c.addEventListener("input",v),i.addEventListener("change",(function(){m(),i.checked||(d.classList.contains("js--wrong-input")||d.classList.add("js--wrong-input"),u.classList.contains("js--error")||u.classList.add("js--error")),i.checked&&(d.classList.contains("js--wrong-input")&&d.classList.remove("js--wrong-input"),u.classList.contains("js--error")&&u.classList.remove("js--error"))})),n.addEventListener("submit",(function(n){n.preventDefault(),e.classList.remove("js--personal-data"),e.classList.add("js--registration-end"),t[1].classList.add("js--checked"),t[2].classList.add("js--active")}))}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhvcml6YXRpb24uanMiLCJhY2NvdW50LmpzIiwiY29udGFjdHMuanMiLCJkZXZpY2UtZGF0YS5qcyIsInBlcnNvbmFsLWRhdGEuanMiXSwibmFtZXMiOlsibmFtZUlucHV0IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicGFzc3dvcmRJbnB1dCIsInN1Ym1pdEJ1dHRvbiIsIm9uSW5wdXQiLCJldnQiLCJ0YXJnZXQiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsInJlbW92ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJ2YWx1ZSIsImFkZCIsIm9sZFByb2R1Y3RzQnV0dG9uIiwib2xkUHJvZHVjdHNTaG93Iiwib2xkUHJvZHVjdHNIaWRlIiwib2xkUHJvZHVjdHMiLCJvbGRQcm9kdWN0c0J1dHRvblRvZ2dsZSIsIml0ZW0iLCJ0b2dnbGUiLCJkZXZpY2VSZWdpc3RyYXRpb24iLCJyZWdpc3RyYXRpb25JdGVtIiwicXVlcnlTZWxlY3RvckFsbCIsImNvbnRhY3RzUGhvbmUiLCJjb250YWN0c0NvZGUiLCJwaG9uZUlucHV0IiwiY29kZUlucHV0IiwicGhvbmVCdXR0b24iLCJjb2RlQnV0dG9uIiwicGhvbmVGb3JtIiwiY29kZUZvcm0iLCJjaGFuZ2VCdXR0b24iLCJzZWxlY3RlZFBob25lIiwiY29kZUVycm9yIiwiY29kZUxhYmVsIiwiRVJST1JfTUVTU0FHRVMiLCJhdHRlbXB0cyIsIklucHV0bWFzayIsIm1hc2siLCJwbGFjZWhvbGRlciIsInNob3ciLCJoaWRlIiwic3RyIiwibGVuZ3RoIiwiaW5kZXhPZiIsInJlbW92ZUF0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsInByZXZlbnREZWZhdWx0IiwidGV4dENvbnRlbnQiLCJib2R5IiwiZGV2aWNlRGF0YUZvcm0iLCJ3YXJyYW50eUNvZGVCdXR0b24iLCJwb3B1cCIsInBvcHVwQ2xvc2UiLCJwb3B1cE92ZXJsYXkiLCJjYWxlbmRhcklucHV0IiwiY2FsZW5kYXJCdXR0b24iLCJzZXJpYWxOdW1iZXJJbnB1dCIsImRhdGFTdWJtaXQiLCJjaGVja1ZhbGlkaXR5IiwidGVzdCIsImdldENvcnJlY3ROdW1iZXIiLCJudW0iLCJNYXRoIiwiZmxvb3IiLCJwaWNrZXIiLCJQaWthZGF5IiwiZmllbGQiLCJmaXJzdERheSIsIm9uU2VsZWN0IiwiZGF0ZSIsIkRhdGUiLCJkYXkiLCJnZXREYXRlIiwibW9udGgiLCJnZXRNb250aCIsInllYXIiLCJnZXRGdWxsWWVhciIsIm9uU2VyaWFsTnVtYmVySW5wdXQiLCJpZCIsIm5leHRTaWJsaW5nIiwiZm9jdXMiLCJjbG9zZVBvcHVwIiwiZm9yRWFjaCIsImVsIiwiY29uc29sZSIsImxvZyIsImZvcm0iLCJzdXJuYW1lSW5wdXQiLCJwYXRyb255bWljSW5wdXQiLCJjaXR5SW5wdXQiLCJlbWFpbElucHV0IiwiY2hlY2tib3giLCJjaGVja2JveExhYmVsIiwiYWdyZWVtZW50IiwidmFsaWRpdHkiLCJ2YWxpZCIsImNoZWNrZWQiLCJsYWJlbCIsInBhcmVudE5vZGUiXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0EsSUFBQUEsRUFBQUMsU0FBQUMsY0FBQSxzQkFDQUMsRUFBQUYsU0FBQUMsY0FBQSwwQkFDQUUsRUFBQUgsU0FBQUMsY0FBQSwwQkFFQSxHQUFBRixHQUFBRyxHQUFBQyxFQUFBLENBSUEsSUFVQUMsRUFBQSxTQUFBQyxHQUNBLElBQUFDLEVBQUFELEVBQUFDLE9BQ0FBLEVBQUFDLFVBQUFDLFNBQUEsb0JBQ0FGLEVBQUFDLFVBQUFFLE9BQUEsb0JBSUFOLEVBQUFPLGlCQUFBLFNBakJBLFdBQ0EsS0FBQVgsRUFBQVksT0FDQVosRUFBQVEsVUFBQUssSUFBQSxtQkFHQSxLQUFBVixFQUFBUyxPQUNBVCxFQUFBSyxVQUFBSyxJQUFBLHNCQVlBYixFQUFBVyxpQkFBQSxRQUFBTixHQUNBRixFQUFBUSxpQkFBQSxRQUFBTixJQTVCQSxHQ0FBLFdBQ0EsSUFBQVMsRUFBQWIsU0FBQUMsY0FBQSw4QkFDQWEsRUFBQWQsU0FBQUMsY0FBQSw0QkFDQWMsRUFBQWYsU0FBQUMsY0FBQSw0QkFDQWUsRUFBQWhCLFNBQUFDLGNBQUEsK0JBRUEsR0FBQVksRUFBQSxDQUlBLElBQUFJLEVBQUEsU0FBQUMsR0FDQUEsRUFBQVgsVUFBQVksT0FBQSxTQUNBRCxFQUFBWCxVQUFBWSxPQUFBLFdBU0FOLEVBQUFILGlCQUFBLFNBTkEsV0FDQU8sRUFBQUgsR0FDQUcsRUFBQUYsR0FDQUMsRUFBQVQsVUFBQVksT0FBQSxZQWxCQSxHQ0FBLFdBQ0EsSUFBQUMsRUFBQXBCLFNBQUFDLGNBQUEsd0JBQ0FvQixFQUFBckIsU0FBQXNCLGlCQUFBLHlDQUdBQyxHQURBdkIsU0FBQUMsY0FBQSxhQUNBRCxTQUFBQyxjQUFBLDRCQUNBdUIsRUFBQXhCLFNBQUFDLGNBQUEsbUJBQ0F3QixFQUFBekIsU0FBQUMsY0FBQSw4QkFDQXlCLEVBQUExQixTQUFBQyxjQUFBLDRCQUNBMEIsRUFBQTNCLFNBQUFDLGNBQUEsZ0NBQ0EyQixFQUFBNUIsU0FBQUMsY0FBQSwrQkFDQTRCLEVBQUE3QixTQUFBQyxjQUFBLHlCQUNBNkIsRUFBQTlCLFNBQUFDLGNBQUEsd0JBQ0E4QixFQUFBL0IsU0FBQUMsY0FBQSxpREFDQStCLEVBQUFoQyxTQUFBQyxjQUFBLDZCQUNBZ0MsRUFBQWpDLFNBQUFDLGNBQUEsaUNBQ0FpQyxFQUFBbEMsU0FBQUMsY0FBQSw4QkFHQWtDLEVBQ0EsMkNBREFBLEVBRUEsaUZBR0FDLEVBQUEsRUFFQSxHQUFBWCxFQUFBLENBSUEsSUFBQVksVUFBQSxvQkFDQUMsS0FBQWIsR0FFQSxJQUFBWSxVQUFBLFVBQUEsQ0FBQUUsWUFBQSxLQUNBRCxLQUFBWixHQUVBLElBQUFjLEVBQUEsU0FBQXRCLEdBQ0FBLEVBQUFYLFVBQUFDLFNBQUEsV0FDQVUsRUFBQVgsVUFBQUUsT0FBQSxXQUlBZ0MsRUFBQSxTQUFBdkIsR0FDQUEsRUFBQVgsVUFBQUMsU0FBQSxXQUNBVSxFQUFBWCxVQUFBSyxJQUFBLFdBK0VBYSxFQUFBZixpQkFBQSxTQS9EQSxXQUNBLElBQUFnQyxFQUFBakIsRUFBQWQsTUFDQSxLQUFBK0IsRUFBQUMsU0FBQSxJQUFBRCxFQUFBRSxRQUFBLEtBQ0FqQixFQUFBa0IsZ0JBQUEsWUFFQWxCLEVBQUFtQixhQUFBLFdBQUEsT0EyREFmLEVBQUFyQixpQkFBQSxTQXZEQSxXQUNBVSxFQUFBYixVQUFBRSxPQUFBLGdCQUNBVyxFQUFBYixVQUFBSyxJQUFBLG1CQUVBUyxFQUFBLEdBQUFkLFVBQUFFLE9BQUEsZUFDQVksRUFBQSxHQUFBZCxVQUFBRSxPQUFBLGNBRUErQixFQUFBakIsR0FDQWtCLEVBQUFqQixNQWdEQUssRUFBQW5CLGlCQUFBLFVBN0NBLFNBQUFMLEdBQ0FBLEVBQUEwQyxpQkFDQWYsRUFBQWdCLFlBQUF2QixFQUFBZCxNQUNBOEIsRUFBQWxCLEdBQ0FpQixFQUFBaEIsTUEwQ0FFLEVBQUFoQixpQkFBQSxTQXZDQSxXQXRDQXVCLEVBQUFlLFlBQUEsR0FFQWQsRUFBQTNCLFVBQUFDLFNBQUEsY0FDQTBCLEVBQUEzQixVQUFBRSxPQUFBLGFBR0FpQixFQUFBbkIsVUFBQUMsU0FBQSxvQkFDQWtCLEVBQUFuQixVQUFBRSxPQUFBLG1CQWlDQSxJQUFBaUIsRUFBQWYsTUFBQWdDLE9BQ0FmLEVBQUFpQixnQkFBQSxZQUVBakIsRUFBQWtCLGFBQUEsV0FBQSxPQW1DQWhCLEVBQUFwQixpQkFBQSxVQS9CQSxTQUFBTCxHQUNBQSxFQUFBMEMsaUJBL0VBLFlBZ0ZBckIsRUFBQWYsT0FDQXVCLEVBQUEzQixVQUFBQyxTQUFBLGNBQ0EwQixFQUFBM0IsVUFBQUssSUFBQSxhQUdBYyxFQUFBbkIsVUFBQUMsU0FBQSxvQkFDQWtCLEVBQUFuQixVQUFBSyxJQUFBLG1CQUdBLElBQUF3QixJQUNBSCxFQUFBZSxZQUFBYixHQUdBQyxFQUFBLElBQ0FILEVBQUFlLFlBQUFiLEVBQ0FQLEVBQUFrQixhQUFBLFdBQUEsS0FHQVYsTUFFQWhCLEVBQUFiLFVBQUFLLElBQUEscUJBQ0FRLEVBQUFiLFVBQUFFLE9BQUEscUJBdkhBLEdDQUEsV0FDQSxJQUFBd0MsRUFBQWpELFNBQUFDLGNBQUEsUUFFQW1CLEVBQUFwQixTQUFBQyxjQUFBLHdCQUNBb0IsRUFBQXJCLFNBQUFzQixpQkFBQSx5Q0FHQTRCLEdBREFsRCxTQUFBQyxjQUFBLGdCQUNBRCxTQUFBQyxjQUFBLHNCQUNBa0QsRUFBQW5ELFNBQUFDLGNBQUEsdUNBQ0FtRCxFQUFBcEQsU0FBQUMsY0FBQSxtQkFDQW9ELEVBQUFyRCxTQUFBQyxjQUFBLDBCQUNBcUQsRUFBQXRELFNBQUFDLGNBQUEsNEJBRUFzRCxFQUFBdkQsU0FBQUMsY0FBQSwrQkFDQXVELEVBQUF4RCxTQUFBQyxjQUFBLDBCQUVBd0QsRUFBQXpELFNBQUFzQixpQkFBQSwrQkFDQW9DLEVBQUExRCxTQUFBQyxjQUFBLHdCQUVBLEdBQUFrRCxFQUFBLENBSUEsSUFBQVEsRUFBQSxXQUVBLElBQUFGLEVBQUEsR0FBQTlDLE1BQUFnQyxRQUNBLElBQUFjLEVBQUEsR0FBQTlDLE1BQUFnQyxRQUNBLElBQUFjLEVBQUEsR0FBQTlDLE1BQUFnQyxRQUNBLFlBQUFpQixLQUFBTCxFQUFBNUMsT0FFQStDLEVBQUFiLGdCQUFBLFlBRUFhLEVBQUFaLGFBQUEsV0FBQSxLQUlBZSxFQUFBLFNBQUFDLEdBQ0EsT0FBQUMsS0FBQUMsTUFBQUYsRUFBQSxJQUFBLEVBQUFBLEVBQUEsSUFBQUEsR0FhQUcsRUFBQSxJQUFBQyxRQUFBLENBQ0FDLE1BQUFYLEVBQ0FZLFNBQUEsRUFDQUMsU0FBQSxXQUNBLElBQUFDLEVBQUEsSUFBQUMsS0FBQU4sR0FDQVYsRUFBQTVDLE1BZkEsU0FBQTJELEdBQ0EsSUFFQUUsR0FGQUYsRUFBQSxJQUFBQyxLQUFBRCxJQUVBRyxVQUNBQyxFQUFBSixFQUFBSyxXQUFBLEVBQ0FDLEVBQUFOLEVBQUFPLGNBRUEsT0FBQWhCLEVBQUFXLEdBQUEsSUFBQVgsRUFBQWEsR0FBQSxJQUFBRSxFQVFBSCxDQUFBSCxHQUNBWCxPQUlBLElBQUF0QixVQUFBLGFBQUEsQ0FBQUUsWUFBQSxlQUNBRCxLQUFBaUIsR0FFQSxJQUFBdUIsRUFBQSxTQUFBekUsR0FDQSxJQUFBQyxFQUFBRCxFQUFBQyxPQUVBLElBQUFBLEVBQUFLLE1BQUFnQyxRQUNBckMsRUFBQUMsVUFBQUMsU0FBQSxvQkFDQUYsRUFBQUMsVUFBQUUsT0FBQSxtQkFHQSxvQkFBQUgsRUFBQXlFLElBQUEsb0JBQUF6RSxFQUFBeUUsSUFDQXpFLEVBQUEwRSxZQUFBQSxZQUFBQyxRQUdBLG9CQUFBM0UsRUFBQXlFLElBQ0F4QixFQUFBMEIsU0FHQTNFLEVBQUFDLFVBQUFLLElBQUEsbUJBR0ErQyxLQWNBdUIsRUFBQSxXQUNBOUIsRUFBQTdDLFVBQUFLLElBQUEsVUFDQXFDLEVBQUExQyxVQUFBRSxPQUFBLFVBd0JBMEMsRUFBQXpDLGlCQUFBLFNBckJBLFdBVEEwQyxFQUFBN0MsVUFBQUUsT0FBQSxVQUNBd0MsRUFBQTFDLFVBQUFLLElBQUEsWUE4QkF5QyxFQUFBM0MsaUJBQUEsU0FsQkEsV0FDQXdFLE9Ba0JBNUIsRUFBQTVDLGlCQUFBLFNBZkEsV0FDQXdFLE9BZ0JBekIsRUFBQTBCLFNBQUEsU0FBQUMsR0FDQUEsRUFBQTFFLGlCQUFBLFFBQUFvRSxNQUdBdkIsRUFBQTdDLGlCQUFBLFNBN0NBLFdBQ0FpRCxJQUNBMEIsUUFBQUMsSUFBQS9CLEVBQUE1QyxNQUFBZ0MsV0E0Q0FPLEVBQUF4QyxpQkFBQSxVQWxCQSxTQUFBTCxHQUNBQSxFQUFBMEMsaUJBQ0EzQixFQUFBYixVQUFBSyxJQUFBLGdCQUNBUSxFQUFBYixVQUFBRSxPQUFBLG1CQUVBWSxFQUFBLEdBQUFkLFVBQUFLLElBQUEsZUFDQVMsRUFBQSxHQUFBZCxVQUFBSyxJQUFBLGtCQXZIQSxHQ0FBLFdBQ0EsSUFBQVEsRUFBQXBCLFNBQUFDLGNBQUEsd0JBQ0FvQixFQUFBckIsU0FBQXNCLGlCQUFBLHlDQUVBaUUsRUFBQXZGLFNBQUFDLGNBQUEsd0JBQ0F1RixFQUFBeEYsU0FBQUMsY0FBQSx3Q0FDQUYsRUFBQUMsU0FBQUMsY0FBQSxxQ0FDQXdGLEVBQUF6RixTQUFBQyxjQUFBLDJDQUNBeUYsRUFBQTFGLFNBQUFDLGNBQUEscUNBQ0EwRixFQUFBM0YsU0FBQUMsY0FBQSxzQ0FDQTJGLEVBQUE1RixTQUFBQyxjQUFBLHlDQUNBNEYsRUFBQTdGLFNBQUFDLGNBQUEsMkNBQ0E2RixFQUFBOUYsU0FBQUMsY0FBQSxnQ0FDQUUsRUFBQUgsU0FBQUMsY0FBQSwwQkFFQSxHQUFBdUYsRUFBQSxDQUlBLElBQUE3QixFQUFBLFdBRUE2QixFQUFBTyxTQUFBQyxPQUNBakcsRUFBQWdHLFNBQUFDLE9BQ0FQLEVBQUFNLFNBQUFDLE9BQ0FOLEVBQUFLLFNBQUFDLE9BQ0FMLEVBQUFJLFNBQUFDLE9BQ0FKLEVBQUFLLFFBRUE5RixFQUFBMEMsZ0JBQUEsWUFFQTFDLEVBQUEyQyxhQUFBLFdBQUEsS0FJQTFDLEVBQUEsU0FBQUMsR0FDQXNELElBRUEsSUFBQXpDLEVBQUFiLEVBQUFDLE9BQ0E0RixFQUFBaEYsRUFBQWlGLFdBQUFsRyxjQUFBLEtBRUFpQixFQUFBNkUsU0FBQUMsUUFDQUUsRUFBQTNGLFVBQUFDLFNBQUEsY0FDQTBGLEVBQUEzRixVQUFBSyxJQUFBLGFBR0FNLEVBQUFYLFVBQUFDLFNBQUEsb0JBQ0FVLEVBQUFYLFVBQUFLLElBQUEsb0JBSUFNLEVBQUE2RSxTQUFBQyxRQUNBRSxFQUFBM0YsVUFBQUMsU0FBQSxjQUNBMEYsRUFBQTNGLFVBQUFFLE9BQUEsYUFHQVMsRUFBQVgsVUFBQUMsU0FBQSxvQkFDQVUsRUFBQVgsVUFBQUUsT0FBQSxxQkF1Q0ErRSxFQUFBOUUsaUJBQUEsUUFBQU4sR0FDQUwsRUFBQVcsaUJBQUEsUUFBQU4sR0FDQXFGLEVBQUEvRSxpQkFBQSxRQUFBTixHQUNBc0YsRUFBQWhGLGlCQUFBLFFBQUFOLEdBQ0F1RixFQUFBakYsaUJBQUEsUUFBQU4sR0FDQXdGLEVBQUFsRixpQkFBQSxVQXZDQSxXQUNBaUQsSUFFQWlDLEVBQUFLLFVBQ0FKLEVBQUF0RixVQUFBQyxTQUFBLG9CQUNBcUYsRUFBQXRGLFVBQUFLLElBQUEsbUJBR0FrRixFQUFBdkYsVUFBQUMsU0FBQSxjQUNBc0YsRUFBQXZGLFVBQUFLLElBQUEsY0FJQWdGLEVBQUFLLFVBQ0FKLEVBQUF0RixVQUFBQyxTQUFBLG9CQUNBcUYsRUFBQXRGLFVBQUFFLE9BQUEsbUJBR0FxRixFQUFBdkYsVUFBQUMsU0FBQSxjQUNBc0YsRUFBQXZGLFVBQUFFLE9BQUEsaUJBc0JBOEUsRUFBQTdFLGlCQUFBLFVBakJBLFNBQUFMLEdBQ0FBLEVBQUEwQyxpQkFFQTNCLEVBQUFiLFVBQUFFLE9BQUEscUJBQ0FXLEVBQUFiLFVBQUFLLElBQUEsd0JBRUFTLEVBQUEsR0FBQWQsVUFBQUssSUFBQSxlQUNBUyxFQUFBLEdBQUFkLFVBQUFLLElBQUEsa0JBNUZBIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICB2YXIgbmFtZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImlucHV0W25hbWU9J25hbWUnXVwiKTtcbiAgdmFyIHBhc3N3b3JkSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRbbmFtZT0ncGFzc3dvcmQnXVwiKTtcbiAgdmFyIHN1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hdXRob3JpemF0aW9uX19idXR0b24nKTtcblxuICBpZiAoIW5hbWVJbnB1dCB8fCAhcGFzc3dvcmRJbnB1dCB8fCAhc3VibWl0QnV0dG9uKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG9uU3VibWl0QnV0dG9uQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKG5hbWVJbnB1dC52YWx1ZSA9PT0gJycpIHtcbiAgICAgIG5hbWVJbnB1dC5jbGFzc0xpc3QuYWRkKCdqcy0td3JvbmctaW5wdXQnKTtcbiAgICB9XG5cbiAgICBpZiAocGFzc3dvcmRJbnB1dC52YWx1ZSA9PT0gJycpIHtcbiAgICAgIHBhc3N3b3JkSW5wdXQuY2xhc3NMaXN0LmFkZCgnanMtLXdyb25nLWlucHV0Jyk7XG4gICAgfVxuICB9XG5cbiAgdmFyIG9uSW5wdXQgPSBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgdmFyIHRhcmdldCA9IGV2dC50YXJnZXQ7XG4gICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLS13cm9uZy1pbnB1dCcpKSB7XG4gICAgICB0YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnanMtLXdyb25nLWlucHV0Jyk7XG4gICAgfVxuICB9XG5cbiAgc3VibWl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25TdWJtaXRCdXR0b25DbGljayk7XG4gIG5hbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uSW5wdXQpO1xuICBwYXNzd29yZElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25JbnB1dCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgdmFyIG9sZFByb2R1Y3RzQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5vdC11c2VkLXByb2R1Y3RzX19idXR0b24nKTtcbiAgdmFyIG9sZFByb2R1Y3RzU2hvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ub3QtdXNlZC1wcm9kdWN0c19fc2hvdycpO1xuICB2YXIgb2xkUHJvZHVjdHNIaWRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5vdC11c2VkLXByb2R1Y3RzX19oaWRlJyk7XG4gIHZhciBvbGRQcm9kdWN0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ub3QtdXNlZC1wcm9kdWN0c19fY29udGVudCcpO1xuXG4gIGlmICghb2xkUHJvZHVjdHNCdXR0b24pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgb2xkUHJvZHVjdHNCdXR0b25Ub2dnbGUgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgIGl0ZW0uY2xhc3NMaXN0LnRvZ2dsZSgnc2hvd24nKTtcbiAgICBpdGVtLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpO1xuICB9O1xuXG4gIHZhciBvbk9sZFByb2R1Y3RzQnV0dG9uQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgb2xkUHJvZHVjdHNCdXR0b25Ub2dnbGUob2xkUHJvZHVjdHNTaG93KTtcbiAgICBvbGRQcm9kdWN0c0J1dHRvblRvZ2dsZShvbGRQcm9kdWN0c0hpZGUpO1xuICAgIG9sZFByb2R1Y3RzLmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgfTtcblxuICBvbGRQcm9kdWN0c0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT2xkUHJvZHVjdHNCdXR0b25DbGljayk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGRldmljZVJlZ2lzdHJhdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kZXZpY2UtcmVnaXN0cmF0aW9uJyk7XG4gIHZhciByZWdpc3RyYXRpb25JdGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRldmljZS1yZWdpc3RyYXRpb25fX25hdmlnYXRpb24taXRlbScpO1xuXG4gIHZhciBjb250YWN0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250YWN0cycpO1xuICB2YXIgY29udGFjdHNQaG9uZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250YWN0c19fcGhvbmUtbnVtYmVyJyk7XG4gIHZhciBjb250YWN0c0NvZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udGFjdHNfX2NvZGUnKTtcbiAgdmFyIHBob25lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRbbmFtZT0ncGhvbmUtbnVtYmVyJ11cIik7XG4gIHZhciBjb2RlSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRbbmFtZT0ncGhvbmUtY29kZSddXCIpXG4gIHZhciBwaG9uZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250YWN0c19fcGhvbmUtZm9ybSBidXR0b24nKTtcbiAgdmFyIGNvZGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udGFjdHNfX2NvZGUtZm9ybSBidXR0b24nKVxuICB2YXIgcGhvbmVGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRhY3RzX19waG9uZS1mb3JtJyk7XG4gIHZhciBjb2RlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250YWN0c19fY29kZS1mb3JtJyk7XG4gIHZhciBjaGFuZ2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udGFjdHNfX3Byb2R1Y3QtY2FyZCAucHJvZHVjdC1jYXJkX19jaGFuZ2UnKTtcbiAgdmFyIHNlbGVjdGVkUGhvbmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udGFjdHNfX3NlbGVjdGVkLXBob25lJyk7XG4gIHZhciBjb2RlRXJyb3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udGFjdHNfX2NvZGUtZXJyb3ItbWVzc2FnZScpO1xuICB2YXIgY29kZUxhYmVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRhY3RzX19jb2RlLWZvcm0gbGFiZWwnKTtcblxuICB2YXIgQ09SUkVDVF9DT0RFID0gJzAwMDAwMDAnO1xuICB2YXIgRVJST1JfTUVTU0FHRVMgPSB7XG4gICAgZmlyc3Q6ICfQo9C60LDQt9Cw0L0g0L3QtdCy0LXRgNC90YvQuSDQutC+0LQsINC+0YHRgtCw0LvQvtGB0Ywg0L/QvtC/0YvRgtC+0Lo6IDEnLFxuICAgIHNlY29uZDogJ9CS0Ysg0L/RgNC10LLRi9GB0LjQu9C4INC60L7Qu9C40YfQtdGB0YLQstC+INC/0L7Qv9GL0YLQvtC6LCDRgdC70LXQtNGD0Y7RidC40Lkg0LfQsNC/0YDQvtGBINC60L7QtNCwINCy0L7Qt9C80L7QttC10L0g0YfQtdGA0LXQtyAxMCDQvNC40L3Rg9GCJ1xuICB9O1xuXG4gIHZhciBhdHRlbXB0cyA9IDA7XG5cbiAgaWYgKCFwaG9uZUlucHV0KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGltUGhvbmUgPSBuZXcgSW5wdXRtYXNrKCcrNyg5OTkpOTk5LTk5LTk5Jyk7XG4gIGltUGhvbmUubWFzayhwaG9uZUlucHV0KTtcblxuICB2YXIgaW1Db2RlID0gbmV3IElucHV0bWFzaygnOTk5OTk5OScsIHsgcGxhY2Vob2xkZXI6ICcnIH0pO1xuICBpbUNvZGUubWFzayhjb2RlSW5wdXQpO1xuXG4gIHZhciBzaG93ID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpZiAoaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpKSB7XG4gICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgaGlkZSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaWYgKCFpdGVtLmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykpIHtcbiAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBjbGVhckVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgIGNvZGVFcnJvci50ZXh0Q29udGVudCA9ICcnO1xuXG4gICAgaWYgKGNvZGVMYWJlbC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLS1lcnJvcicpKSB7XG4gICAgICBjb2RlTGFiZWwuY2xhc3NMaXN0LnJlbW92ZSgnanMtLWVycm9yJyk7XG4gICAgfVxuXG4gICAgaWYgKGNvZGVJbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLS13cm9uZy1pbnB1dCcpKSB7XG4gICAgICBjb2RlSW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgnanMtLXdyb25nLWlucHV0Jyk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBvblBob25lSW5wdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHN0ciA9IHBob25lSW5wdXQudmFsdWU7XG4gICAgaWYgKHN0ci5sZW5ndGggPT09IDE2ICYmIHN0ci5pbmRleE9mKCdfJykgPT09IC0xKSB7XG4gICAgICBwaG9uZUJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBob25lQnV0dG9uLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBvbkNoYW5nZUJ1dHRvbkNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIGRldmljZVJlZ2lzdHJhdGlvbi5jbGFzc0xpc3QucmVtb3ZlKCdqcy0tY29udGFjdHMnKTtcbiAgICBkZXZpY2VSZWdpc3RyYXRpb24uY2xhc3NMaXN0LmFkZCgnanMtLWRldmljZS1kYXRhJyk7XG5cbiAgICByZWdpc3RyYXRpb25JdGVtWzBdLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLS1jaGVja2VkJyk7XG4gICAgcmVnaXN0cmF0aW9uSXRlbVsxXS5jbGFzc0xpc3QucmVtb3ZlKCdqcy0tYWN0aXZlJyk7XG5cbiAgICBzaG93KGNvbnRhY3RzUGhvbmUpO1xuICAgIGhpZGUoY29udGFjdHNDb2RlKTtcbiAgfTtcblxuICB2YXIgb25QaG9uZVN1Ym1pdCA9IGZ1bmN0aW9uIChldnQpIHtcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICBzZWxlY3RlZFBob25lLnRleHRDb250ZW50ID0gcGhvbmVJbnB1dC52YWx1ZTtcbiAgICBoaWRlKGNvbnRhY3RzUGhvbmUpO1xuICAgIHNob3coY29udGFjdHNDb2RlKTtcbiAgfTtcblxuICB2YXIgb25Db2RlSW5wdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2xlYXJFcnJvcigpO1xuICAgIGlmIChjb2RlSW5wdXQudmFsdWUubGVuZ3RoID09PSA3KSB7XG4gICAgICBjb2RlQnV0dG9uLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29kZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfVxuXG4gIHZhciBvbkNvZGVTdWJtaXQgPSBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKGNvZGVJbnB1dC52YWx1ZSAhPT0gQ09SUkVDVF9DT0RFKSB7XG4gICAgICBpZiAoIWNvZGVMYWJlbC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLS1lcnJvcicpKSB7XG4gICAgICAgIGNvZGVMYWJlbC5jbGFzc0xpc3QuYWRkKCdqcy0tZXJyb3InKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFjb2RlSW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy0td3JvbmctaW5wdXQnKSkge1xuICAgICAgICBjb2RlSW5wdXQuY2xhc3NMaXN0LmFkZCgnanMtLXdyb25nLWlucHV0Jyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChhdHRlbXB0cyA9PT0gMCkge1xuICAgICAgICBjb2RlRXJyb3IudGV4dENvbnRlbnQgPSBFUlJPUl9NRVNTQUdFUy5maXJzdDtcbiAgICAgIH1cblxuICAgICAgaWYgKGF0dGVtcHRzID4gMCkge1xuICAgICAgICBjb2RlRXJyb3IudGV4dENvbnRlbnQgPSBFUlJPUl9NRVNTQUdFUy5zZWNvbmQ7XG4gICAgICAgIGNvZGVCdXR0b24uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICAgIH1cblxuICAgICAgYXR0ZW1wdHMrKztcbiAgICB9IGVsc2Uge1xuICAgICAgZGV2aWNlUmVnaXN0cmF0aW9uLmNsYXNzTGlzdC5hZGQoJ2pzLS1wZXJzb25hbC1kYXRhJyk7XG4gICAgICBkZXZpY2VSZWdpc3RyYXRpb24uY2xhc3NMaXN0LnJlbW92ZSgnanMtLWNvbnRhY3RzJyk7XG4gICAgfVxuICB9O1xuXG4gIHBob25lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvblBob25lSW5wdXQpO1xuICBjaGFuZ2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNoYW5nZUJ1dHRvbkNsaWNrKTtcbiAgcGhvbmVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIG9uUGhvbmVTdWJtaXQpO1xuICBjb2RlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbkNvZGVJbnB1dCk7XG4gIGNvZGVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIG9uQ29kZVN1Ym1pdCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XG5cbiAgdmFyIGRldmljZVJlZ2lzdHJhdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kZXZpY2UtcmVnaXN0cmF0aW9uJyk7XG4gIHZhciByZWdpc3RyYXRpb25JdGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRldmljZS1yZWdpc3RyYXRpb25fX25hdmlnYXRpb24taXRlbScpO1xuXG4gIHZhciBkZXZpY2VEYXRhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRldmljZS1kYXRhJyk7XG4gIHZhciBkZXZpY2VEYXRhRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kZXZpY2UtZGF0YSBmb3JtJyk7XG4gIHZhciB3YXJyYW50eUNvZGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibGFiZWxbZm9yPSdzZXJpYWwtbnVtYmVyLTEnXSBidXR0b25cIik7XG4gIHZhciBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC13YXJyYW50eScpO1xuICB2YXIgcG9wdXBDbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC13YXJyYW50eV9fY2xvc2UnKTtcbiAgdmFyIHBvcHVwT3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC13YXJyYW50eV9fb3ZlcmxheScpO1xuXG4gIHZhciBjYWxlbmRhcklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRldmljZS1kYXRhX19wdXJjaGFzZS1kYXRlJyk7XG4gIHZhciBjYWxlbmRhckJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kZXZpY2UtZGF0YV9fY2FsZW5kYXInKTtcblxuICB2YXIgc2VyaWFsTnVtYmVySW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGV2aWNlLWRhdGFfX3NlcmlhbC1udW1iZXInKTtcbiAgdmFyIGRhdGFTdWJtaXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZGV2aWNlLWRhdGFfX3N1Ym1pdCcpO1xuXG4gIGlmKCF3YXJyYW50eUNvZGVCdXR0b24pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgY2hlY2tWYWxpZGl0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZihcbiAgICAgIHNlcmlhbE51bWJlcklucHV0WzBdLnZhbHVlLmxlbmd0aCA9PT0gNlxuICAgICAgJiYgc2VyaWFsTnVtYmVySW5wdXRbMV0udmFsdWUubGVuZ3RoID09PSA2XG4gICAgICAmJiBzZXJpYWxOdW1iZXJJbnB1dFsyXS52YWx1ZS5sZW5ndGggPT09IDZcbiAgICAgICYmICgvXlswLTkuXSskLykudGVzdChjYWxlbmRhcklucHV0LnZhbHVlKVxuICAgICkge1xuICAgICAgZGF0YVN1Ym1pdC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRhdGFTdWJtaXQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIGdldENvcnJlY3ROdW1iZXIgPSBmdW5jdGlvbiAobnVtKSB7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IobnVtIC8gMTApID4gMCA/IG51bSA6ICcwJyArIG51bTtcbiAgfTtcblxuICB2YXIgZ2V0RGF0ZSA9IGZ1bmN0aW9uIChkYXRlKSB7XG4gICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShkYXRlKTtcblxuICAgIHZhciBkYXkgPSBkYXRlLmdldERhdGUoKTtcbiAgICB2YXIgbW9udGggPSBkYXRlLmdldE1vbnRoKCkgKyAxO1xuICAgIHZhciB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xuXG4gICAgcmV0dXJuIGdldENvcnJlY3ROdW1iZXIoZGF5KSArICcuJyArIGdldENvcnJlY3ROdW1iZXIobW9udGgpICsgJy4nICsgeWVhcjtcbiAgfTtcblxuICB2YXIgcGlja2VyID0gbmV3IFBpa2FkYXkoe1xuICAgIGZpZWxkOiBjYWxlbmRhckJ1dHRvbixcbiAgICBmaXJzdERheTogMSxcbiAgICBvblNlbGVjdDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKHBpY2tlcik7XG4gICAgICBjYWxlbmRhcklucHV0LnZhbHVlID0gZ2V0RGF0ZShkYXRlKTtcbiAgICAgIGNoZWNrVmFsaWRpdHkoKTtcbiAgICB9XG4gIH0pO1xuXG4gIHZhciBpbSA9IG5ldyBJbnB1dG1hc2soJzk5Ljk5Ljk5OTknLCB7ICdwbGFjZWhvbGRlcic6ICfQlNCULtCc0Jwu0JPQk9CT0JMnfSk7XG4gIGltLm1hc2soY2FsZW5kYXJJbnB1dCk7XG5cbiAgdmFyIG9uU2VyaWFsTnVtYmVySW5wdXQgPSBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgdmFyIHRhcmdldCA9IGV2dC50YXJnZXQ7XG5cbiAgICBpZiAodGFyZ2V0LnZhbHVlLmxlbmd0aCA9PT0gNikge1xuICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLS13cm9uZy1pbnB1dCcpKSB7XG4gICAgICAgIHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdqcy0td3JvbmctaW5wdXQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRhcmdldC5pZCA9PT0gJ3NlcmlhbC1udW1iZXItMScgfHwgdGFyZ2V0LmlkID09PSAnc2VyaWFsLW51bWJlci0yJykge1xuICAgICAgICB0YXJnZXQubmV4dFNpYmxpbmcubmV4dFNpYmxpbmcuZm9jdXMoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRhcmdldC5pZCA9PT0gJ3NlcmlhbC1udW1iZXItMycpIHtcbiAgICAgICAgY2FsZW5kYXJJbnB1dC5mb2N1cygpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0YXJnZXQuY2xhc3NMaXN0LmFkZCgnanMtLXdyb25nLWlucHV0Jyk7XG4gICAgfVxuXG4gICAgY2hlY2tWYWxpZGl0eSgpO1xuICB9O1xuXG4gIHZhciBvbkNhbGVuZGFySW5wdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2hlY2tWYWxpZGl0eSgpO1xuICAgIGNvbnNvbGUubG9nKGNhbGVuZGFySW5wdXQudmFsdWUubGVuZ3RoKTtcblxuICB9O1xuXG4gIHZhciBvcGVuUG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG4gICAgYm9keS5jbGFzc0xpc3QuYWRkKCdwb3B1cCcpO1xuICB9O1xuXG4gIHZhciBjbG9zZVBvcHVwID0gZnVuY3Rpb24gKCkge1xuICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICAgIGJvZHkuY2xhc3NMaXN0LnJlbW92ZSgncG9wdXAnKTtcbiAgfVxuXG4gIHZhciBvbldhcnJhbnR5Q29kZUJ1dHRvbkNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIG9wZW5Qb3B1cCgpO1xuICB9O1xuXG4gIHZhciBvblBvcHVwQ2xvc2VDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICBjbG9zZVBvcHVwKCk7XG4gIH07XG5cbiAgdmFyIG9uUG9wdXBPdmVybGF5Q2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2xvc2VQb3B1cCgpO1xuICB9O1xuXG4gIHZhciBvblN1Ym1pdCA9IGZ1bmN0aW9uIChldnQpIHtcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICBkZXZpY2VSZWdpc3RyYXRpb24uY2xhc3NMaXN0LmFkZCgnanMtLWNvbnRhY3RzJyk7XG4gICAgZGV2aWNlUmVnaXN0cmF0aW9uLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLS1kZXZpY2UtZGF0YScpO1xuXG4gICAgcmVnaXN0cmF0aW9uSXRlbVswXS5jbGFzc0xpc3QuYWRkKCdqcy0tY2hlY2tlZCcpO1xuICAgIHJlZ2lzdHJhdGlvbkl0ZW1bMV0uY2xhc3NMaXN0LmFkZCgnanMtLWFjdGl2ZScpO1xuICB9O1xuXG4gIHdhcnJhbnR5Q29kZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uV2FycmFudHlDb2RlQnV0dG9uQ2xpY2spO1xuICBwb3B1cENsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25Qb3B1cENsb3NlQ2xpY2spO1xuICBwb3B1cE92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvblBvcHVwT3ZlcmxheUNsaWNrKTtcblxuICBzZXJpYWxOdW1iZXJJbnB1dC5mb3JFYWNoKGZ1bmN0aW9uIChlbCkge1xuICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25TZXJpYWxOdW1iZXJJbnB1dCk7XG4gIH0pO1xuXG4gIGNhbGVuZGFySW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbkNhbGVuZGFySW5wdXQpO1xuICBkZXZpY2VEYXRhRm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBvblN1Ym1pdCk7XG59KCkpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGRldmljZVJlZ2lzdHJhdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kZXZpY2UtcmVnaXN0cmF0aW9uJyk7XG4gIHZhciByZWdpc3RyYXRpb25JdGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRldmljZS1yZWdpc3RyYXRpb25fX25hdmlnYXRpb24taXRlbScpO1xuXG4gIHZhciBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBlcnNvbmFsLWRhdGFfX2Zvcm0nKTtcbiAgdmFyIHN1cm5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGVyc29uYWwtZGF0YSBpbnB1dFtuYW1lPSdzdXJuYW1lJ11cIik7XG4gIHZhciBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBlcnNvbmFsLWRhdGEgaW5wdXRbbmFtZT0nbmFtZSddXCIpO1xuICB2YXIgcGF0cm9ueW1pY0lucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wZXJzb25hbC1kYXRhIGlucHV0W25hbWU9J3BhdHJvbnltaWMnXVwiKTtcbiAgdmFyIGNpdHlJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGVyc29uYWwtZGF0YSBpbnB1dFtuYW1lPSdjaXR5J11cIik7XG4gIHZhciBlbWFpbElucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wZXJzb25hbC1kYXRhIGlucHV0W25hbWU9J2VtYWlsJ11cIik7XG4gIHZhciBjaGVja2JveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGVyc29uYWwtZGF0YSBpbnB1dFt0eXBlPSdjaGVja2JveCddXCIpO1xuICB2YXIgY2hlY2tib3hMYWJlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wZXJzb25hbC1kYXRhX19hZ3JlZW1lbnQtd3JhcHBlciBsYWJlbCcpO1xuICB2YXIgYWdyZWVtZW50ID1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBlcnNvbmFsLWRhdGFfX3RleHQtd3JhcHBlclwiKTtcbiAgdmFyIHN1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wZXJzb25hbC1kYXRhX19idXR0b24nKTtcblxuICBpZiAoIXN1cm5hbWVJbnB1dCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBjaGVja1ZhbGlkaXR5ID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChcbiAgICAgIHN1cm5hbWVJbnB1dC52YWxpZGl0eS52YWxpZFxuICAgICAgJiYgbmFtZUlucHV0LnZhbGlkaXR5LnZhbGlkXG4gICAgICAmJiBwYXRyb255bWljSW5wdXQudmFsaWRpdHkudmFsaWRcbiAgICAgICYmIGNpdHlJbnB1dC52YWxpZGl0eS52YWxpZFxuICAgICAgJiYgZW1haWxJbnB1dC52YWxpZGl0eS52YWxpZFxuICAgICAgJiYgY2hlY2tib3guY2hlY2tlZFxuICAgICkge1xuICAgICAgc3VibWl0QnV0dG9uLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3VibWl0QnV0dG9uLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBvbklucHV0ID0gZnVuY3Rpb24gKGV2dCkge1xuICAgIGNoZWNrVmFsaWRpdHkoKTtcblxuICAgIHZhciBpdGVtID0gZXZ0LnRhcmdldDtcbiAgICB2YXIgbGFiZWwgPSBpdGVtLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcigncCcpO1xuXG4gICAgaWYgKCFpdGVtLnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICBpZiAoIWxhYmVsLmNsYXNzTGlzdC5jb250YWlucygnanMtLWVycm9yJykpIHtcbiAgICAgICAgbGFiZWwuY2xhc3NMaXN0LmFkZCgnanMtLWVycm9yJyk7XG4gICAgICB9XG5cbiAgICAgIGlmICghaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLS13cm9uZy1pbnB1dCcpKSB7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnanMtLXdyb25nLWlucHV0Jyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGl0ZW0udmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIGlmIChsYWJlbC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLS1lcnJvcicpKSB7XG4gICAgICAgIGxhYmVsLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLS1lcnJvcicpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLS13cm9uZy1pbnB1dCcpKSB7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnanMtLXdyb25nLWlucHV0Jyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgdmFyIG9uQ2hlY2tib3hDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICBjaGVja1ZhbGlkaXR5KCk7XG5cbiAgICBpZiAoIWNoZWNrYm94LmNoZWNrZWQpIHtcbiAgICAgIGlmICghY2hlY2tib3hMYWJlbC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLS13cm9uZy1pbnB1dCcpKSB7XG4gICAgICAgIGNoZWNrYm94TGFiZWwuY2xhc3NMaXN0LmFkZCgnanMtLXdyb25nLWlucHV0Jyk7XG4gICAgICB9XG5cbiAgICAgIGlmICghYWdyZWVtZW50LmNsYXNzTGlzdC5jb250YWlucygnanMtLWVycm9yJykpIHtcbiAgICAgICAgYWdyZWVtZW50LmNsYXNzTGlzdC5hZGQoJ2pzLS1lcnJvcicpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjaGVja2JveC5jaGVja2VkKSB7XG4gICAgICBpZiAoY2hlY2tib3hMYWJlbC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLS13cm9uZy1pbnB1dCcpKSB7XG4gICAgICAgIGNoZWNrYm94TGFiZWwuY2xhc3NMaXN0LnJlbW92ZSgnanMtLXdyb25nLWlucHV0Jyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChhZ3JlZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy0tZXJyb3InKSkge1xuICAgICAgICBhZ3JlZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnanMtLWVycm9yJyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgdmFyIG9uRm9ybVN1Ym1pdCA9IGZ1bmN0aW9uIChldnQpIHtcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIGRldmljZVJlZ2lzdHJhdGlvbi5jbGFzc0xpc3QucmVtb3ZlKCdqcy0tcGVyc29uYWwtZGF0YScpO1xuICAgIGRldmljZVJlZ2lzdHJhdGlvbi5jbGFzc0xpc3QuYWRkKCdqcy0tcmVnaXN0cmF0aW9uLWVuZCcpO1xuXG4gICAgcmVnaXN0cmF0aW9uSXRlbVsxXS5jbGFzc0xpc3QuYWRkKCdqcy0tY2hlY2tlZCcpO1xuICAgIHJlZ2lzdHJhdGlvbkl0ZW1bMl0uY2xhc3NMaXN0LmFkZCgnanMtLWFjdGl2ZScpO1xuICB9O1xuXG4gIHN1cm5hbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uSW5wdXQpO1xuICBuYW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbklucHV0KTtcbiAgcGF0cm9ueW1pY0lucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25JbnB1dCk7XG4gIGNpdHlJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uSW5wdXQpO1xuICBlbWFpbElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25JbnB1dCk7XG4gIGNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQ2hlY2tib3hDbGljayk7XG5cbiAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBvbkZvcm1TdWJtaXQpO1xufSkoKTtcbiJdfQ==
